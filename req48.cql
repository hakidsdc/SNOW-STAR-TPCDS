MATCH(d:date_dim{d_year:1998})<-[:ON_Date]-(ss:store_sales) WITH ss MATCH (ss:store_sales)-[:AT_Store]->(s:store) WITH ss MATCH (ss:store_sales)-[:BY_Customer]->(c:customer) WITH ss, c MATCH (c:customer)-[:Current_CDemo]->(cd:customer_demographics) WITH ss, c, cd MATCH (c)-[:Current_Addr]->(ca:customer_address) WITH ss, c, ca, cd WHERE ((cd.cd_marital_status= 'M' and cd.cd_education_status= '4 yr Degree' and ss.ss_sales_price>=100.00 AND ss.ss_sales_price<=150.00) or (cd.cd_marital_status= 'D' and  cd.cd_education_status = 'Primary' and ss.ss_sales_price>=50.00 and ss.ss_sales_price<=100.00) or (cd.cd_marital_status= 'U' and  cd.cd_education_status = 'Advanced Degree' and ss.ss_sales_price>=150.00 and ss.ss_sales_price<=200.00)) and ((ca.ca_country = 'United States' and ca.ca_state in ['KY', 'GA', 'NM'] and ss.ss_net_profit>=0 and ss.ss_net_profit<=2000) or (ca.ca_country = 'United States' and ca.ca_state in ['MT', 'OR', 'IN'] and ss.ss_net_profit>=150 and ss.ss_net_profit<=3000) or (ca.ca_country = 'United States' and ca.ca_state in ['WI', 'MO', 'WV'] and ss.ss_net_profit>=50 and ss.ss_net_profit<=25000 )) return sum(ss.ss_quantity);
